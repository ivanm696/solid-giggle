plugins:
  - jekyll-github-metadata
  - jekyll-seo-tag
  - jekyll-coffeesc
theme: jekyll-theme-primer name: Report remaining open issues
on:
  schedule:
    # Daily at 8:20 UTC
    - cron: '20 8 * * *'
jobs:
  track_pr:
    runs-on: ubuntu-latest
    steps:
      - name: Get open issue count üöÄ
        # –®–∞–≥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö Issues —Å –ø–æ–º–æ—â—å—é GraphQL
        run: |
          # –í GraphQL –ø–æ–ª–µ 'states' –æ–∂–∏–¥–∞–µ—Ç —Å–ø–∏—Å–æ–∫ (–º–∞—Å—Å–∏–≤) —Å–æ—Å—Ç–æ—è–Ω–∏–π, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º [OPEN].
          numOpenIssues="$(gh api graphql -F owner=$OWNER -F name=$REPO -f query='
            query($name: String!, $owner: String!) {
              repository(owner: $owner, name: $name) {
                issues(states: [OPEN]){ # <-- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ó–î–ï–°–¨
                  totalCount
                }
              }
            }
          ' --jq '.data.repository.issues.totalCount')"

          # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ä–µ–¥—ã, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ.
          echo 'NUM_OPEN_ISSUES='$numOpenIssues >> $GITHUB_ENV
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OWNER: ${{ github.repository_owner }}
          REPO: ${{ github.event.repository.name }}

      - name: Create issue report üìù
        # –®–∞–≥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ Issue —Å –æ—Ç—á—ë—Ç–æ–º.
        run: |
          # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é $NUM_OPEN_ISSUES, —Å–æ–∑–¥–∞–Ω–Ω—É—é –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —à–∞–≥–µ.
          gh issue create --title "Issue report" --body "$NUM_OPEN_ISSUES issues remaining" --repo $GITHUB_REPOSITORY
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

name: Report remaining open issues
on:
  schedule:
    # –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 8:20 UTC
    - cron: '20 8 * * *'
  workflow_dispatch: # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é –¥–ª—è —Ç–µ—Å—Ç–∞

jobs:
  track_pr:
    runs-on: ubuntu-latest
    permissions:
      issues: write # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ Issues
    steps:
      - name: Get open issue count üöÄ
        run: |
          numOpenIssues="$(gh api graphql -F owner=$OWNER -F name=$REPO -f query='
            query($name: String!, $owner: String!) {
              repository(owner: $owner, name: $name) {
                issues(states: [OPEN]){
                  totalCount
                }
              }
            }
          ' --jq '.data.repository.issues.totalCount')"

          echo "NUM_OPEN_ISSUES=$numOpenIssues" >> $GITHUB_ENV
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OWNER: ${{ github.repository_owner }}
          REPO: ${{ github.event.repository.name }}

      - name: Create issue report üìù
        run: |
          gh issue create --title "Daily Issue Report" --body "There are currently $NUM_OPEN_ISSUES open issues in this repository." --repo $GITHUB_REPOSITORY
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
